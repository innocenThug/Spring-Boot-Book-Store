<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Online Book Store</title>
  <link rel="stylesheet" th:href="@{https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css}" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <link rel="stylesheet" th:href="@{https://fonts.googleapis.com/css2?family=Raleway:wght@100;200;300;400}">
  <link rel="stylesheet" th:href="@{https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=swap_vert}"/>
<link th:href="@{/css/index.css}" rel="stylesheet" type="text/css">
   </head>
<body>
  <header>
    <div class="company-logo"><a th:href="@{/}"><img th:src="@{/images/supernova.svg}" alt=""></a></div>
    <nav class="navbar navbar-expand-lg navbar-dark">
      <ul class="items">
        <li class="item"><a th:href="@{/addbookform}" class="link">ADD NEW BOOK</a></li>
        <li class="item"><a th:href="@{/find}" class="link">GET BOOK BY ID</a></li>
      </ul>
    </nav>
  </header>
  <div th:if="${message}">
    <script th:inline="javascript">
      alert(`[[${message}]]`);
    </script>
    <h1 class="text-center custom-heading" th:text="${message}"></h1>
  </div>

  <div class="container my-2">
    <h1 class="text-center" id="list">LIST OF BOOKS</h1>
    <div class="table-responsive">
      <table class="table table-hover">
        <thead>
          <tr>
            <th class="text-center custom-th">Book Id
              <a th:href="@{'/page/' + ${currentPage} + '?sortField=id&sortOrder=' + ${reverseSortOrder}}">
                <i class="material-symbols-rounded">swap_vert</i>
              </a>
            </th>
            <th class="text-center custom-th">Book Title
              <a th:href="@{'/page/' + ${currentPage} + '?sortField=title&sortOrder=' + ${reverseSortOrder}}">
                <i class="material-symbols-rounded">swap_vert</i>
              </a>
            </th>
            <th class="text-center custom-th">Book Author
              <a th:href="@{'/page/' + ${currentPage} + '?sortField=author&sortOrder=' + ${reverseSortOrder}}">
                <i class="material-symbols-rounded">swap_vert</i>
              </a>
            </th>
            <th class="text-center custom-th">Book Genre
              <a th:href="@{'/page/' + ${currentPage} + '?sortField=genre&sortOrder=' + ${reverseSortOrder}}">
                <i class="material-symbols-rounded">swap_vert</i>
              </a>
            </th>
            <th class="text-center custom-th">Book Price
              <a th:href="@{'/page/' + ${currentPage} + '?sortField=price&sortOrder=' + ${reverseSortOrder}}">
                <i class="material-symbols-rounded">swap_vert</i>
              </a>
            </th>
            <th class="text-center custom-th">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="book : ${listBooks}">
            <th class="text-center" th:text="${book.id}"></th>
            <td class="text-center" th:text="${book.title}"></td>
            <td class="text-center" th:text="${book.author}"></td>
            <td class="text-center" th:text="${book.genre}"></td>
            <td class="text-center" th:text="${book.price}"></td>
            <td class="text-center">
              <a th:href="@{/showupdateform/{id}(id=${book.id})}" class="btn btn-primary">Update</a>
              <a th:href="@{/deletebook/{id}(id=${book.id})}" class="btn btn-danger">Delete</a>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <!-- Pagination and Sorting-->          
        <div th:if="${totalBooks > 1}">
			<div class="row col-sm-10 pagination justify-content-end">
				<!-- Total Books --> 
				<div class="col-sm-3">Total Books: [[${totalBooks}]]</div>
				<!-- Previous --> 
				<div class="col-sm-1">
					<a class="page-item" aria-label="Previous" th:if="${currentPage > 1}" th:href="@{'/page/' + ${currentPage-1} + '?pageSize=' + ${pageSize} + '&sortField=' + ${sortField} + '&sortOrder=' + ${sortOrder}}">&lsaquo;<span class="sr-only">Previous</span></a>
					<span class="page-item disabled" th:unless="${currentPage > 1}">&lsaquo;<span class="sr-only">Previous</span></span>
				</div>
				<!-- Pagination Page Numbers --> 
				<div class="col-sm-1">
					<span th:each="i:${#numbers.sequence(1,totalPages)}">
						<a class="page-item" th:if="${currentPage != i}" th:href="@{'/page/'+${i}+'?pageSize=' + ${pageSize} + '&sortField=' + ${sortField}  + '&sortOrder=' + ${sortOrder}}">[[${i}]]</a>
						<span class="page-item active" th:unless="${currentPage != i}" >[[${i}]]</span> &nbsp; &nbsp;
					</span>
				</div>
				<!-- Next --> 
				<div class="col-sm-1">
					<a class="page-item" aria-label="Next" th:if="${currentPage < totalPages}" th:href="@{'/page/'+${currentPage+1}+'?pageSize=' + ${pageSize} + '&sortField=' + ${sortField}  + '&sortOrder=' + ${sortOrder}}">&rsaquo;<span class="sr-only">Next</span></a>
					<span class="page-item disabled" th:unless="${currentPage < totalPages}">&rsaquo;<span class="sr-only">Next</span></span>
				</div>
				<!-- Last --> 
				<div class="col-sm-1">
					<a class="page-item" aria-label="Last" th:if="${currentPage < totalPages}" th:href="@{'/page/'+${totalPages}+'?pageSize=' + ${pageSize} + '&sortField=' + ${sortField}  + '&sortOrder=' + ${sortOrder}}">&raquo;<span class="sr-only">Last</span></a>
					<span class="page-item disabled" th:unless="${currentPage < totalPages}">&raquo;<span class="sr-only">Last</span></span>
				</div>   
		<!-- Pagination Page Size Customization and Sorting --> 
				<div th:if="${totalBooks > 1}" class="col-sm-4">
					<form action="#" method="get">
   						<label for="pageSize">Page Size: </label>
   							<select name="pageSize" id="pageSize" onchange="this.form.submit()">
      							<option value="5" th:selected="${pageSize == 5}">5</option>
      							<option value="10" th:selected="${pageSize == 10}">10</option>
        						<option value="20" th:selected="${pageSize == 20}">20</option>
        						<option value="50" th:selected="${pageSize == 50}">50</option>
        						<option value="100" th:selected="${pageSize == 100}">100</option>
    						</select>
    			<!-- Add hidden fields for sort parameters and current page -->
        					<input type="hidden" name="page" th:value="${currentPage}"/>
        					<input type="hidden" name="sortField" th:value="${sortField}"/>
        					<input type="hidden" name="sortOrder" th:value="${sortOrder}"/>
						</form>
					</div>
    			</div>
    		</div>
	</div>
</body>
</html>